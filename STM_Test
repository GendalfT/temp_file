#define ADC_BUF_LEN 16

uint16_t adc_buf[ADC_BUF_LEN];
char msg[64];

HAL_ADC_Start_DMA(&hadc1, (uint32_t*)adc_buf, ADC_BUF_LEN);


void HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc)
{
    uint32_t sum = 0;
    for (int i = 0; i < ADC_BUF_LEN; i++)
        sum += adc_buf[i];

    float avg = sum / (float)ADC_BUF_LEN;
    float volt = (avg * 3.3f) / 4095.0f;

    int len = sprintf(msg, "Voltage: %.2f V\r\n", volt);
    HAL_UART_Transmit(&huart1, (uint8_t*)msg, len, HAL_MAX_DELAY);
}

static int counter = 0;
counter++;
sprintf(msg, "Callback #%d\r\n", counter);
HAL_UART_Transmit(&huart1, (uint8_t*)msg, strlen(msg), HAL_MAX_DELAY);

HAL_GPIO_TogglePin(GPIOB, GPIO_PIN_0);  // блимає LED на кожне спрацювання
